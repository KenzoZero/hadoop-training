CREATE EXTERNAL TABLE flighttable(key string,aircraftdelay FLOAT,arrdelay FLOAT,carrierdelay FLOAT,depdelay FLOAT,weatherdelay float,cncl FLOAT,cnclcode string, tailnum string, airtime FLOAT, distance FLOAT, elaptime FLOAT,arrtime int, deptime int, dom int, dow int, month int)
 STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler'
  WITH SERDEPROPERTIES ("hbase.columns.mapping" = ":key,delay:aircraftdelay,delay:arrdelay,delay:carrierdelay,delay:depdelay,delay:weatherdelay,info:cncl,info:cnclcode,info:tailnum,stats:airtime,stats:distance,stats:elaptime,timing:arrtime,timing:deptime,timing:dom,timing:dow,timing:month")
  TBLPROPERTIES("hbase.table.name" = "/user/user01/tables/airline");

select key,  a.arrdelay, a.elaptime, a.airtime, a.distance 
from flighttable a
order by a.arrdelay desc limit 20;  

select key ,  a.arrdelay, a.elaptime, a.airtime, a.distance, ((a.distance / a.airtime) * 60) as airspeed
from flighttable a
order by airspeed desc limit 20;

select count(*) as cancellations,cnclcode
from flighttable 
where cncl=1 
group by cnclcode
order by cancellations asc limit 100;

select count(*) as cancellations 
from flighttable 
where cncl=1 and key like "AA%";

select arrdelay,key 
from flighttable 
where arrdelay > 1000;

select max(arrdelay)
from flighttable 
where key like "UA%";

select key , arrdelay, month
from flighttable 
order by arrdelay desc limit 20;

select max(carrierdelay), dom
from flighttable 
group by dom;

select key , a.arrdelay,  a.distance 
from flighttable a
order by a.arrdelay desc limit 20;

select max(a.carrierdelay) as CarrierDelayMinutes 
from flighttable a
where  key like "DL%";



